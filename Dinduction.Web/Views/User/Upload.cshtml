@{
    ViewBag.Title = "Upload";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="min-h-screen bg-gray-50 flex items-start justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="w-full max-w-md">
        <div class="bg-white rounded-xl shadow-lg p-6 animate-fadeIn">
            <div class="flex items-center gap-3 mb-4">
                <!-- friendly upload icon (small) -->
                <svg class="w-8 h-8 text-blue-500 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 3v8m0 0l-3-3m3 3 3-3M21 15v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2" />
                </svg>

                <div>
                    <h3 class="text-lg font-semibold text-gray-900">Upload User Quiz</h3>
                    <p class="mt-1 text-sm text-gray-500">Upload an .xlsx template to import user quiz data (H - H+2)</p>
                </div>
            </div>

            <form asp-action="UploadUser" asp-controller="User" method="post" enctype="multipart/form-data" id="upload-form" class="space-y-6">
                @Html.AntiForgeryToken()

                <div>
                    <label for="importexcelfile" class="block text-sm font-medium text-gray-700 mb-2">Template file</label>

                    <div id="file-drop" class="relative cursor-pointer rounded-lg border-2 border-dashed border-gray-200 bg-white p-5 flex flex-col items-center justify-center text-center hover:border-blue-300 hover:bg-blue-50 transition">
                        <!-- smaller, friendly file icon -->
                        <svg class="w-10 h-10 text-green-500 mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2" d="M12 3v6m0 0l-3-3m3 3 3-3M21 12v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6" />
                        </svg>

                        <div class="text-sm text-gray-700 font-medium">Choose Template file</div>
                        <div id="file-name" class="mt-2 text-xs text-gray-500">No file selected</div>

                        <!-- visually hidden native file input for accessibility -->
                        <input id="importexcelfile" name="importexcelfile" type="file" accept=".xlsx" class="sr-only" />
                        <div class="mt-3 text-xs text-gray-400">Accepted: .xlsx</div>
                    </div>
                </div>

                <div class="flex items-center justify-between">
                    <a href="@Url.Content("~/AdminLTE/dist/img/Template.xlsx")"
                       class="inline-flex items-center gap-2 px-3 py-2 border border-gray-200 rounded-md text-sm text-gray-700 hover:bg-gray-50">
                        <!-- simple download icon -->
                        <svg class="w-4 h-4 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4" d="M12 3v12m0 0l4-4m-4 4-4-4M21 21H3" />
                        </svg>
                        Download Template
                    </a>

                    <button id="uploadButton" type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold rounded-md shadow">
                        <span class="btn-text">Upload</span>
                        <svg id="upload-spinner" class="w-4 h-4 animate-spin hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12a9 9 0 0114.32-7.032M21 12v1" />
                        </svg>
                    </button>
                </div>

                <div class="mt-3 text-sm text-gray-600 bg-gray-50 p-3 rounded-md flex items-center gap-2">
                    <!-- info icon -->
                    <svg class="w-4 h-4 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4" d="M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 100 20 10 10 0 000-20z" />
                    </svg>
                    User can login H - H+2 data uploaded
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
            const fileInput = document.getElementById('importexcelfile');
            const fileNameEl = document.getElementById('file-name');
            const fileDrop = document.getElementById('file-drop');
            const uploadForm = document.getElementById('upload-form');
            const uploadButton = document.getElementById('uploadButton');
            const spinner = document.getElementById('upload-spinner');

            // Update file-name when user selects file
            fileInput.addEventListener('change', function (e) {
                const name = (e.target.files && e.target.files.length > 0) ? e.target.files[0].name : 'No file selected';
                fileNameEl.textContent = name;
            });

            // Make the whole drop area clickable to open file dialog
            fileDrop.addEventListener('click', function () {
                fileInput.click();
            });

            // Basic drag & drop file selection
            fileDrop.addEventListener('dragover', function (e) {
                e.preventDefault();
                fileDrop.classList.add('border-blue-300', 'bg-blue-50');
            });
            fileDrop.addEventListener('dragleave', function () {
                fileDrop.classList.remove('border-blue-300', 'bg-blue-50');
            });
            fileDrop.addEventListener('drop', function (e) {
                e.preventDefault();
                fileDrop.classList.remove('border-blue-300', 'bg-blue-50');
                const dt = e.dataTransfer;
                if (dt && dt.files && dt.files.length > 0) {
                    fileInput.files = dt.files;
                    const name = dt.files[0].name;
                    fileNameEl.textContent = name;
                }
            });

            // On submit: show spinner and disable button to avoid double submit
            uploadForm.addEventListener('submit', function () {
                uploadButton.setAttribute('disabled', 'disabled');
                spinner.classList.remove('hidden');
                uploadButton.classList.add('opacity-80', 'cursor-not-allowed');
            });
        })();
    </script>

    <style>
        /* small animation utility (Tailwind alternative if not available) */
        @@keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.35s ease-in-out; }
        /* sr-only utility if not defined */
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
    </style>
}